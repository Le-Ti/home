#!/usr/bin/python
'''Add a host to a managed /etc/hosts file.

I don't remember what motivated me to create this.
'''

import sys
import time

if __name__ == '__main__':
    hostname = sys.argv[1]
    newip = sys.argv[2]

    orighosts = file("/etc/hosts").readlines()
    out = sys.stdout #file("/etc/hosts","w")
    matched = 0
    print >> out, "# Regenerated by %s, on %s" % (sys.argv[0], time.ctime())
    for line in orighosts:
        line = line.strip()
        if not len(line):
            print >> out, ""
            continue
        if line.startswith("# Regenerated by"):
            continue
        if line.startswith("#") or line.startswith("127."):
            print >> out, line
            continue
        try:
            (data,comment) = line.strip().split("#",1)
        except ValueError:
            data = line.strip()
            comment = ""
        names = data.split(None)
        ip = names.pop(0)
        if hostname+" " in line:
            ip = newip
            matched+=1
        print >> out, "%-16s %34s #%-30s" % (ip, " ".join(names), comment)
    if not matched:
        comment = "Added %s" % time.ctime()
        print >> out, "%-16s %34s #%-30s" % (newip, hostname, comment)
